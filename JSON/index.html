<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <title>Formularz</title>
    <script>

        window.addEventListener('load', function() {
            console.log("ID: " + localStorage.identyfikator);
            if(localStorage.identyfikator != "undefined"){
                document.getElementById('generowane_id').value=localStorage.identyfikator;
                document.getElementById("id").innerHTML = "id: " + localStorage.identyfikator;
            }  
            check();
        }, true);

        function czysc() {
            localStorage.clear();
            console.log("***Zmieniono ID***");
            console.log("ID: " + localStorage.identyfikator);
            document.getElementById('generowane_id').value = '';
            document.getElementById("id").innerHTML = "id: " + localStorage.identyfikator;
            
            document.getElementById('CheckID').style.display = "inline";

            document.getElementById('WyborWzor').style.display = "none";
            document.getElementById('WyborKolorData').style.display = "none";
            document.getElementById('WyborPodpowiedz').style.display = "none";


        }

        function check() {

            var identyfikator;
            var wartosc = document.getElementById('generowane_id').value;

            if (wartosc != '') {
                localStorage.identyfikator = wartosc;
                identyfikator = localStorage.identyfikator;
                console.log("ID: " + identyfikator);
            }

            if (wartosc != ''  && czyIstniejeID() !== "undefined" ) {

                document.getElementById('button_dalej').disabled = false;
                document.getElementById('button_dalej').style.display = "inline";
                return true;
            } else {
                document.getElementById('button_dalej').disabled = true;
                document.getElementById('button_dalej').style.display = "none";
                return false;
            }
        }

        function czyIstniejeID() {
            if (localStorage.identyfikator !== "undefined") {
                var id = document.getElementById('generowane_id').value;
                var url = "OSOBA/" + document.getElementById('generowane_id').value;
                var http = new XMLHttpRequest();
                http.open('HEAD', url, false);
                http.send();
                if (http.status != 404)
                    return "istnieje";
                else
                    return "nie istnieje";
            } else {
                return "undefined";
            }
        }

        function dalej(flaga) {

            console.log("dalej-ID: " + localStorage.identyfikator);
            document.getElementById("id").innerHTML = "dalej-id: " + localStorage.identyfikator;

            var ajax = new XMLHttpRequest;
            ajax.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(ajax.responseText);
                    }
                }

            if (check() == true) {
                if (flaga == "WyborWzor") {
                    console.log("*****************Wybor Wzor *****************");
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborWzor').style.display = "inline";
                    document.getElementById('WyborPodpowiedz').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "none";
                } else if (flaga == "WyborPodpowiedz") {
                    console.log("*****************WyborPodpowiedz*****************");
                    document.getElementById('WyborWzor').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "none";
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborPodpowiedz').style.display = "inline";
                } else if (flaga == "WyborKolorData") {
                    console.log("*****************WyborKolorData*****************");
                    document.getElementById('WyborPodpowiedz').style.display = "none";
                    document.getElementById('WyborWzor').style.display = "none";
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "inline";
                }
            } else {
                alert("Nie podano wartości");
            }
        }

        function generuj() {
            czysc()
            var text = "";
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (var i = 0; i < 15; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            document.getElementById('generowane_id').value = text;
            document.getElementById("id").innerHTML = "gen-id: " + text;

            check();
        }

        function showHint(str) {
            if (str.length == 0) {
                document.getElementById("txtHint").innerHTML = "";
                return;
            } else {
                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("txtHint").innerHTML = this.responseText;
                    localStorage.kraj = str;
                }
            };
            ajax.open("POST", "praca.php", true);
            ajax.send(JSON.stringify({
                        polecenie: 4,
                        nazwa_pliku: document.getElementById('generowane_id').value,
                        wyraz: str
                    }));
            }
        }

        function WzorIsCheck()
		{
			var rate_value;
			if (document.getElementById('wzor1').checked) {
 				rate_value = document.getElementById('wzor1').value;
				//console.log(rate_value);

                send(rate_value)
            }
			if (document.getElementById('wzor2').checked) {
 				rate_value = document.getElementById('wzor2').value;
				//console.log(rate_value);

                send(rate_value)

            }		
			if (document.getElementById('wzor3').checked) {
 				rate_value = document.getElementById('wzor3').value;
				console.log(rate_value);

                //send(rate_value)
            }
            return rate_value;
			}

            function send(value){

                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("demo1").innerHTML = this.responseText;
                    console.log(this.responseText);
                    localStorage.wzor = value;
                }
            };
            ajax.open("POST", "praca.php", true);
            ajax.send(JSON.stringify({
                        polecenie: 102,
                        nazwa_pliku: document.getElementById('generowane_id').value,
                        wzor: value
                    }));
            console.log(JSON.stringify({
                polecenie: 102,
                nazwa_pliku: document.getElementById('generowane_id').value,
                wzor: value
            }));
            }

    </script>
</head>

<body>
    <header>
        <section>
            <h1>Formularz</h1>
        </section>
    </header>
    <main>

        <div id="CheckID" style="display: inline;">
            Podaj swój Id lub go wygeneruj:
            <input type="text" id="generowane_id" name="generowane_id" onchange="check()" />
            <button type="button" value="generuj" onclick="generuj()">Generuj</button>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborWzor')" style="display: none;" disabled>DALEJ</button>
        </div>

        <div id="WyborWzor" style="display:none;">
            Wybierz wzór:
            <br>
            <input type="radio" id="wzor1" name="wzor" value="1" />
            <label for="wzor1">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a^{b^{c}}} </script>
            </label>
            <br>
            <input type="radio" id="wzor2" name="wzor" value="2" />
            <label for="wzor2">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a}</script>
            </label>
            <br>
            <input type="radio" id="wzor3" name="wzor" value="3" />
            <label for="wzor3">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a^{b}}</script>
            </label>
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="WzorIsCheck(), dalej('WyborPodpowiedz')">DALEJ</button>
            <span id="demo1"></span>
        </div>

        <div id="WyborPodpowiedz" style="display:none;">
            Wybierz państwo:
            <input type="text" id="panstwo" name="panstwo" onkeyup="showHint(this.value)" onchange="check()" />
            <br>
            <br>
            Suggestions:<b><span id="txtHint"></span></b> 
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborWzor')">POWROT</button>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborKolorData')">DALEJ</button>
        </div>

        <div id="WyborKolorData" style="display:none;">
            Wybierz date:
            <input type="date" id="data" name="data" onchange="check()" />
            <br> Wybierz kolor:
            <input type="color" id="kolor" name="kolor" onchange="check()" />
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborPodpowiedz')">POWROT</button>
            <button id="button_dalej" type="button" value="Koniec" onclick="dalej('Koniec')">KONIEC</button>
        </div>
    </main>
    <footer>
        <p style="color:rgb(255,20,147);" id="id"></p>
        <button id="button_dalej" type="button" value="CZYŚĆ" onclick="czysc()">CZYŚĆ</button>
        <p>Autor: Krystian Barczak, MS Inf sem. V</p>
    </footer>
</body>

</html>