<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <title>Formularz</title>
    <script>

        window.addEventListener('load', function() {
            czysc();
            if(document.getElementById('generowane_id').value != null)
            {
                document.getElementById('button_dalej').disabled = false;
                document.getElementById('button_dalej').style.display = "inline";
            }

            if(localStorage.identyfikator !== "undefined"){
                document.getElementById('generowane_id').value = localStorage.identyfikator;
                document.getElementById("id").innerHTML = "id: " + localStorage.identyfikator;
            }

            if(localStorage.wzor !== "undefined"){
                document.getElementById('wzor'+localStorage.wzor).checked=true;
            } 

            if(localStorage.kraj !== "undefined"){
                document.getElementById('panstwo').value = localStorage.kraj;
            } 

            if(localStorage.data !== "undefined"){
                document.getElementById('data').value = localStorage.data;
            } 

            if(localStorage.kolor !== "undefined"){
                document.getElementById('kolor').value = localStorage.kolor;
            } 
            

        }, true);

        function czysc() {

            document.getElementById('generowane_id').value = '';
            document.getElementById('wzor0').checked = false;
            document.getElementById('wzor1').checked = false;
            document.getElementById('wzor2').checked = false;
            document.getElementById('panstwo').value = '';
            document.getElementById('data').value = '';
            document.getElementById('kolor').value = '';
            
            document.getElementById('CheckID').style.display = "inline";
            document.getElementById('WyborWzor').style.display = "none";
            document.getElementById('WyborKolorData').style.display = "none";
            document.getElementById('WyborPodpowiedz').style.display = "none";
            document.getElementById("id").innerHTML = '';

            document.getElementById('button_dalej').disabled = true;
            document.getElementById('button_dalej').style.display = "none"; 
            
            window.localStorage.clear();
        }

        function check() {

            var wartosc = document.getElementById('generowane_id').value;
            
            if (wartosc != '') {
                localStorage.identyfikator = wartosc;
            }

            if (wartosc != ''  && czyIstniejeID() !== "undefined" ) {
                document.getElementById('button_dalej').disabled = false;
                document.getElementById('button_dalej').style.display = "inline";
                return true;
            } else {
                document.getElementById('button_dalej').disabled = true;
                document.getElementById('button_dalej').style.display = "none"; 
                return false;
            }
        }


        function czyIstniejeID() {
            if (localStorage.identyfikator !== "undefined") {
                
                var id = document.getElementById('generowane_id').value;
                var url = "OSOBA/" + document.getElementById('generowane_id').value;
                var http = new XMLHttpRequest();
                http.open('HEAD', url, false);
                http.send();
                if (http.status != 404)
                {
                document.getElementById('generowane_id').value = localStorage.identyfikator;
                    return "istnieje";
                }else{
                 document.getElementById('generowane_id').value = localStorage.identyfikator;
                    return "nie istnieje";
                 }
            } else {
                return "undefined";
            }
        }


        function dalej(flaga) {

            //document.getElementById("id").innerHTML = "id: " + localStorage.identyfikator;

            if (check() == true) {
                if (flaga == "WyborWzor") {
                    console.log("*****************Wybor Wzor *****************");
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborWzor').style.display = "inline";
                    document.getElementById('WyborPodpowiedz').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "none";
                } else if (flaga == "WyborPodpowiedz") {
                    console.log("*****************WyborPodpowiedz*****************");
                    document.getElementById('WyborWzor').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "none";
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborPodpowiedz').style.display = "inline";
                } else if (flaga == "WyborKolorData") {
                    console.log("*****************WyborKolorData*****************");
                    document.getElementById('WyborPodpowiedz').style.display = "none";
                    document.getElementById('WyborWzor').style.display = "none";
                    document.getElementById('CheckID').style.display = "none";
                    document.getElementById('WyborKolorData').style.display = "inline";
                }
            } else {
                alert("Brak wartości");
                document.getElementById('generowane_id').value = '';
                document.getElementById('id').innerHTML = '';
            }
        }

        function generuj() {

            var text = "";
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (var i = 0; i < 15; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            document.getElementById('generowane_id').value = text;
            document.getElementById("id").innerHTML = "id: " + text;

            check();
        }

        function WzorIsCheck()
		{
			var rate_value='';
			if (document.getElementById('wzor0').checked) {
 				rate_value = document.getElementById('wzor0').value;
                console.log(rate_value);
                wyslijWzor(rate_value);
            }

			else if (document.getElementById('wzor1').checked) {
 				rate_value = document.getElementById('wzor1').value;
                 console.log(rate_value);
                 wyslijWzor(rate_value);
            }	

			else if (document.getElementById('wzor2').checked) {
 				rate_value = document.getElementById('wzor2').value;
                console.log(rate_value);
                wyslijWzor(rate_value);
            }
        }

        function pokazPodpowiedz(string) {
            if (string.length == 0) {
                document.getElementById("podpowiedz").innerHTML = "";
                return;
            } else {
                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("podpowiedz").innerHTML = this.responseText;
                    localStorage.kraj = string;
                }
            };
            ajax.open("POST", "praca.php", true);
            ajax.send(JSON.stringify({
                        polecenie: 4,
                        nazwa_pliku: document.getElementById('generowane_id').value,
                        wyraz: string
                    }));
            }
        }

        function wyslijWzor(wzor)
        {
            var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        localStorage.wzor = wzor;
                    }
                };
                
                ajax.open("POST", "praca.php", true);
                ajax.send(JSON.stringify({
                    polecenie: 5,
                    nazwa_pliku: document.getElementById('generowane_id').value,
                    wzor: wzor
                }));
        }

        function wybranyKolor(){
            check();
			if (document.getElementById('kolor').value) {
 				var kolor = document.getElementById('kolor').value;
                console.log(kolor);

                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        localStorage.kolor = kolor;
                    }
                };

                ajax.open("POST", "praca.php", true);
                ajax.send(JSON.stringify({
                    polecenie: 6,
                    nazwa_pliku: document.getElementById('generowane_id').value,
                    kolor: kolor
                }));
            }
        }

        function wybranaData(){
            check();
			if (document.getElementById('data').value) {
 				var data = document.getElementById('data').value;
                console.log(data);

                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        localStorage.data = data;
                    }
                };
                ajax.open("POST", "praca.php", true);
                ajax.send(JSON.stringify({
                    polecenie: 7,
                    nazwa_pliku: document.getElementById('generowane_id').value,
                    data: data
                }));
            }
        }
    </script>
</head>

<body>
    <header>
        <section>
            <h1>Formularz</h1>
        </section>
    </header>
    <main>

        <div id="CheckID" style="display: inline;">
            Podaj swój Id lub go wygeneruj:
            <input type="text" id="generowane_id" name="generowane_id" onkeypress="check()" />
            <button type="button" value="generuj" onclick="generuj()">Generuj</button>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborWzor')" style="display: none;" disabled>DALEJ</button>
        </div>

        <div id="WyborWzor" style="display:none;">
            Wybierz wzór:
            <br>
            <input type="radio" id="wzor0" name="wzor" value="0" />
            <label for="wzor0">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a^{b^{c}}} </script>
            </label>
            <br>
            <input type="radio" id="wzor1" name="wzor" value="1" />
            <label for="wzor1">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a}</script>
            </label>
            <br>
            <input type="radio" id="wzor2" name="wzor" value="2" />
            <label for="wzor2">
                <script type="math/tex; mode=display" id="MathJax-Element-1">a^{a^{b}}</script>
            </label>
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="WzorIsCheck(), dalej('WyborPodpowiedz')">DALEJ</button>
        </div>

        <div id="WyborPodpowiedz" style="display:none;">
            Wybierz państwo:
            <input type="text" id="panstwo" name="panstwo" onkeyup="pokazPodpowiedz(this.value)" onchange="check()" />
            <br>
            <br>
            Suggestions:<b><span id="podpowiedz"></span></b> 
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborWzor')">POWROT</button>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborKolorData')">DALEJ</button>
        </div>

        <div id="WyborKolorData" style="display:none;">
            Wybierz date:
            <input type="date" id="data" name="data" onchange="wybranaData()" />
            <br> Wybierz kolor:
            <input type="color" id="kolor" name="kolor" onchange="wybranyKolor()" />
            <br>
            <button id="button_dalej" type="button" value="Dalej" onclick="dalej('WyborPodpowiedz')">POWROT</button>
            <button id="button_koniec" type="button" value="CZYŚĆ" onclick="czysc()">KONIEC</button>
        </div>
    </main>
    <footer>
        <p style="color:rgb(255,20,147);" id="id"></p>
        <p>Autor: Krystian Barczak, MS Inf sem. V</p>
    </footer>
</body>

</html>